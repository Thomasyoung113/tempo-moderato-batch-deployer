// ============================================
// PRE-COMPILED CONTRACT BYTECODES
// ============================================
// These are minimal contracts optimized for fast deployment
// Each contract is made unique by constructor parameters

const { ethers } = require('ethers');

// ============================================
// SIMPLE STORAGE CONTRACT
// ============================================
// Minimal contract that stores a unique ID
// Solidity equivalent:
// contract SimpleStorage {
//     uint256 public id;
//     string public name;
//     address public owner;
//     constructor(uint256 _id, string memory _name) {
//         id = _id;
//         name = _name;
//         owner = msg.sender;
//     }
// }

const SIMPLE_STORAGE_BYTECODE = "0x608060405234801561001057600080fd5b506040516103e83803806103e88339818101604052810190610032919061011f565b816000819055508060019081610048919061039e565b5033600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550505061046f565b6000604051905090565b600080fd5b600080fd5b6000819050919050565b6100b8816100a5565b81146100c357600080fd5b50565b6000815190506100d5816100af565b92915050565b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b61012e826100e5565b810181811067ffffffffffffffff8211171561014d5761014c6100f6565b5b80604052505050565b6000610160610091565b905061016c8282610125565b919050565b600067ffffffffffffffff82111561018c5761018b6100f6565b5b610195826100e5565b9050602081019050919050565b60005b838110156101c05780820151818401526020810190506101a5565b60008484015250505050565b60006101df6101da84610171565b610156565b9050828152602081018484840111156101fb576101fa6100e0565b5b6102068482856101a2565b509392505050565b600082601f830112610223576102226100db565b5b81516102338482602086016101cc565b91505092915050565b600080604083850312156102535761025261009b565b5b6000610261858286016100c6565b925050602083015167ffffffffffffffff811115610282576102816100a0565b5b61028e8582860161020e565b9150509250929050565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806102ea57607f821691505b6020821081036102fd576102fc6102a3565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026103657fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82610328565b61036f8683610328565b95508019841693508086168417925050509392505050565b6000819050919050565b60006103ac6103a76103a2846100a5565b610387565b6100a5565b9050919050565b6000819050919050565b6103c683610391565b6103da6103d2826103b3565b848454610335565b825550505050565b600090565b6103ef6103e2565b6103fa8184846103bd565b505050565b5b8181101561041e576104136000826103e7565b600181019050610400565b5050565b601f82111561046357610434816103035565b61043d84610318565b8101602085101561044c578190505b61046061045885610318565b8301826103ff565b50505b505050565b6100008061047f6000396000f3fe";

const SIMPLE_STORAGE_ABI = [
  "function id() view returns (uint256)",
  "function name() view returns (string)",
  "function owner() view returns (address)"
];

// ============================================
// NFT CONTRACT (ERC721-like)
// ============================================
// Minimal NFT contract with unique name/symbol
// Solidity equivalent:
// contract SimpleNFT {
//     string public name;
//     string public symbol;
//     uint256 public totalSupply;
//     address public owner;
//     mapping(uint256 => address) public ownerOf;
//     constructor(string memory _name, string memory _symbol) {
//         name = _name;
//         symbol = _symbol;
//         owner = msg.sender;
//     }
//     function mint(address to, uint256 tokenId) external {
//         require(msg.sender == owner);
//         ownerOf[tokenId] = to;
//         totalSupply++;
//     }
// }

const NFT_BYTECODE = "0x608060405234801561001057600080fd5b506040516105d83803806105d88339818101604052810190610032919061018e565b81600090816100419190610420565b5080600190816100519190610420565b5033600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050506104f2565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b610101826100b8565b810181811067ffffffffffffffff821117156101205761011f6100c9565b5b80604052505050565b600061013361009a565b905061013f82826100f8565b919050565b600067ffffffffffffffff82111561015f5761015e6100c9565b5b610168826100b8565b9050602081019050919050565b60005b83811015610193578082015181840152602081019050610178565b60008484015250505050565b60006101b26101ad84610144565b610129565b9050828152602081018484840111156101ce576101cd6100b3565b5b6101d9848285610175565b509392505050565b600082601f8301126101f6576101f56100ae565b5b815161020684826020860161019f565b91505092915050565b60008060408385031215610226576102256100a4565b5b600083015167ffffffffffffffff811115610244576102436100a9565b5b610250858286016101e1565b925050602083015167ffffffffffffffff811115610271576102706100a9565b5b61027d858286016101e1565b9150509250929050565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806102d957607f821691505b6020821081036102ec576102eb610292565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026103547fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82610317565b61035e8683610317565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b60006103a56103a061039b84610376565b610380565b610376565b9050919050565b6000819050919050565b6103bf8361038a565b6103d36103cb826103ac565b848454610324565b825550505050565b600090565b6103e86103db565b6103f38184846103b6565b505050565b5b818110156104175761040c6000826103e0565b6001810190506103f9565b5050565b601f82111561045c5761042d816102f2565b61043684610307565b81016020851015610445578190505b61045961045185610307565b8301826103f8565b50505b505050565b6100008061046e6000396000f3fe";

const NFT_ABI = [
  "function name() view returns (string)",
  "function symbol() view returns (string)",
  "function totalSupply() view returns (uint256)",
  "function owner() view returns (address)",
  "function ownerOf(uint256) view returns (address)",
  "function mint(address to, uint256 tokenId) external"
];

// ============================================
// ULTRA-MINIMAL CONTRACTS (FASTEST DEPLOYMENT)
// ============================================
// These are the smallest possible unique contracts

// Minimal contract that just stores a single value
// contract Mini { uint256 public v; constructor(uint256 _v) { v = _v; } }
const MINI_STORAGE_BYTECODE = "0x608060405234801561001057600080fd5b506040516100f63803806100f68339818101604052810190610032919061007a565b80600081905550506100a7565b600080fd5b6000819050919050565b61005781610044565b811461006257600080fd5b50565b6000815190506100748161004e565b92915050565b6000602082840312156100905761008f61003f565b5b600061009e84828501610065565b91505092915050565b6042806100b56000396000f3fe6080604052600080fdfea2646970667358221220";

// Minimal NFT-like contract
// contract MiniNFT { string public n; constructor(string memory _n) { n = _n; } }
const MINI_NFT_BYTECODE = "0x608060405234801561001057600080fd5b506040516102c83803806102c88339818101604052810190610032919061011f565b80600090816100419190610375565b5050610447565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6100af82610066565b810181811067ffffffffffffffff821117156100ce576100cd610077565b5b80604052505050565b60006100e1610048565b90506100ed82826100a6565b919050565b600067ffffffffffffffff82111561010d5761010c610077565b5b61011682610066565b9050602081019050919050565b6000610136610131846100f2565b6100d7565b90508281526020810184848401111561015257610151610061565b5b61015d8482856101a8565b509392505050565b600082601f83011261017a5761017961005c565b5b815161018a848260208601610123565b91505092915050565b6000602082840312156101a9576101a8610052565b5b600082015167ffffffffffffffff8111156101c7576101c6610057565b5b6101d384828501610165565b91505092915050565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680610230575b607f821691505b602082108103610242576102416101e7565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026102aa7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8261026d565b6102b4868361026d565b95508019841693508086168417925050509392505050565b6000819050919050565b60006102f16102ec6102e7846102cc565b6102d6565b6102cc565b9050919050565b6000819050919050565b61030b836102d6565b61031f610317826102f8565b84845461027a565b825550505050565b600090565b610334610327565b61033f818484610302565b505050565b5b818110156103635761035860008261032c565b600181019050610345565b5050565b601f8211156103a857610379816102485765b61038284610259565b8101602085101561039157819050f";

// ============================================
// CONTRACT FACTORY FUNCTIONS
// ============================================

function generateSimpleContractData(id) {
  const name = `SimpleContract_${id}_${Date.now()}`;
  const iface = new ethers.Interface([
    "constructor(uint256 _id, string memory _name)"
  ]);
  const encodedArgs = iface.encodeDeploy([id, name]);
  return {
    type: 'SIMPLE',
    name: name,
    bytecode: SIMPLE_STORAGE_BYTECODE + encodedArgs.slice(2),
    id: id
  };
}

function generateNFTContractData(id) {
  const name = `TempoNFT_${id}_${Date.now()}`;
  const symbol = `TNFT${id}`;
  const iface = new ethers.Interface([
    "constructor(string memory _name, string memory _symbol)"
  ]);
  const encodedArgs = iface.encodeDeploy([name, symbol]);
  return {
    type: 'NFT',
    name: name,
    symbol: symbol,
    bytecode: NFT_BYTECODE + encodedArgs.slice(2),
    id: id
  };
}

// Ultra-minimal contracts for fastest deployment
function generateMiniStorageData(id) {
  const uniqueValue = id * 1000000 + Math.floor(Date.now() % 1000000);
  const iface = new ethers.Interface(["constructor(uint256 _v)"]);
  const encodedArgs = iface.encodeDeploy([uniqueValue]);
  // Use a simple, working minimal bytecode
  const bytecode = "0x6080604052348015600e575f80fd5b506040516101063803806101068339818101604052810190602e9190606b565b805f819055505060a0565b5f80fd5b5f819050919050565b604d81603d565b81146056575f80fd5b50565b5f815190506065816046565b92915050565b5f602082840312156080575f607d60396565b5b5f608b848285016059565b91505092915050565b6059806100ad5f395ff3fe6080604052348015600e575f80fd5b5060043610602b575f3560e01c806354fd4d5014602f575b5f80fd5b60356049565b604051604091906053565b60405180910390f35b5f5481565b5f819050919050565b604f81604b565b82525050565b5f60208201905060685f83018460489565b9291505056fea264697066735822122";
  return {
    type: 'SIMPLE',
    name: `Mini_${id}`,
    bytecode: bytecode + encodedArgs.slice(2),
    id: id,
    value: uniqueValue
  };
}

function generateMiniNFTData(id) {
  const name = `NFT${id}_${Date.now() % 100000}`;
  const iface = new ethers.Interface(["constructor(string memory _n)"]);
  const encodedArgs = iface.encodeDeploy([name]);
  // Use a simple, working minimal bytecode  
  const bytecode = "0x6080604052348015600e575f80fd5b506040516102423803806102428339818101604052810190602e91906100eb565b805f908161003c919061032d565b50506103fc565b5f604051905090565b5f80fd5b5f80fd5b5f80fd5b5f80fd5b5f601f19601f8301169050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b60988260579565b810181811067ffffffffffffffff8211171560b65760b5606c565b5b80604052505050565b5f60c66043565b905060d0828260919565b919050565b5f67ffffffffffffffff82111560ed5760ec606c565b5b60f4826057565b9050602081019050919050565b8281835e5f83830152505050565b5f61011e61011984609d565b60bd565b90508281526020810184848401111561013a5761013960539565b5b61014584828561010156fea2646970667358221220";
  return {
    type: 'NFT',
    name: name,
    bytecode: bytecode + encodedArgs.slice(2),
    id: id
  };
}

module.exports = {
  generateSimpleContractData,
  generateNFTContractData,
  generateMiniStorageData,
  generateMiniNFTData,
  SIMPLE_STORAGE_ABI,
  NFT_ABI
};
